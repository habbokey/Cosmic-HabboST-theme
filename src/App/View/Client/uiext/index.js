import{r as t,c as e,a as s,w as n,b as i,o as a,d as o,t as r,e as l,F as c,f as d,g as h,h as u,n as g,i as m,v as p,j as f,k as x,l as y,m as v}from"./vendor.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?e.credentials="include":"anonymous"===t.crossorigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var _={props:["theme","alert"],methods:{getTitle(t){switch(t){case 0:return this.$filters.translate("success");case 1:return this.$filters.translate("error");default:return this.$filters.translate("alert")}}}};const w={key:0,class:"h-100 w-100 uiExt-alert-overlay position-absolute d-flex align-items-center justify-content-center"};_.render=function(l,c,d,h,u,g){const m=t("UIExtCard");return d.alert?(a(),e("div",w,[s(m,{theme:d.theme,title:g.getTitle(d.alert.type),onClicked:c[0]||(c[0]=t=>l.$emit("clear")),class:"text-center"},{default:n((()=>[o(r(d.alert.message),1)])),_:1},8,["theme","title"])])):i("",!0)};var k=l({state:{lang:null,config:null,window:{trax:!1,ttt:!1},trax:{tracks:[],editor:!1,alert:null,songs:null,collection:null,visibleCollection:[],collectionPages:0,currentPage:1,editing:null,playlist:{songs:null,playing:!1},playingSong:null,traxplayer:{position:0},volume:0},games:{ttt:{alert:null,playing:!1,invites:[],board:[],turn:null,me:null}}}});class ${parse(t){this._game=t.game,this._user=t.user}existingInvite(t,e){return t.filter((t=>t.id===e))}get game(){return this._game}get user(){return this._user}}class b{parse(t){this._game=t.game,this._visible=t.visible,this._playing=t.playing}get game(){return this._game}get visible(){return this._visible}get playing(){return this._playing}}class S{parse(t){this._board=t.board,this._turn=t.turn,this._me=t.me}get board(){return this._board}get turn(){return this._turn}get me(){return this._me}}class I{parse(t){this._window=t.window,this._message=t.message,this._type=t.type}get window(){return this._window}get message(){return this._message}get type(){return this._type}}class E{parse(t){this._config=t}get config(){return this._config}}class C{parse(t){this._lang=t}get lang(){return this._lang}}class T{parse(t){this._playing=t}get playing(){return this._playing}}class P{parse(t){this._collection=t}get collection(){return this._collection}}class L{parse(t){this._playlist=t}get playlist(){return this._playlist}}class M{parse(t){this._songs=t}get songs(){return this._songs}}class U{parse(t){this._status=t.status,this._editor=t.editor}get status(){return this._status}get editor(){return this._editor}}class q{parse(t){}}class D{parse(t){this._volume=t}get volume(){return this._volume}}class O{constructor(t,e,s=!1){this.header="game_invite",this.data={game:t,user:e,friends:s}}}class j{constructor(t,e){this.header="game_start",this.data={game:t,user:e}}}class B{constructor(t,e){this.header="game_ttt_move",this.data={row:t,col:e}}}class R{constructor(t){this.header="connection",this.data={sso:t}}}class V{constructor(){this.header="config",this.data=null}}class H{constructor(){this.header="language",this.data=null}}class G{constructor(t){this.header="trax_burnSong",this.data={id:t}}}class X{constructor(t,e,s,n){this.header="trax_createSong",this.data={name:t,track:e,length:s,editId:n}}}class A{constructor(t){this.header="trax_deleteSong",this.data={id:t}}}class W{constructor(t,e=!1){this.header="trax_modifyPlaylist",this.data={id:t,remove:e}}}class Y{constructor(){this.header="trax_requestCollections",this.data={}}}class N{constructor(){this.header="trax_requestPlaylist",this.data={}}}class z{constructor(){this.header="trax_mySongs",this.data={}}}class F{constructor(){this.header="trax_togglePlaylist",this.data={}}}class J{constructor(){if(this.reconnect=0,this.connected=!1,this.interval=0,J._instance=this,!UIExtConfig)throw new Error("UIExtConfig is not defined!");this._config=UIExtConfig,this._webSocket=new WebSocket(this._config.ws),this._webSocket.onmessage=this.onMessage.bind(this),this._webSocket.onopen=this.onOpen.bind(this),this._webSocket.onclose=this.onClose.bind(this),this._events=new Map,this._listeners=[],this.registerEvents()}static getInstance(){return J._instance||(J._instance=new J),J._instance}registerEvents(){this._events.set("ping",new q),this._events.set("language",new C),this._events.set("config",new E),this._events.set("alert",new I),this._events.set("volume",new D),this._events.set("trax_window",new U),this._events.set("trax_requestedSongs",new M),this._events.set("trax_requestedCollections",new P),this._events.set("trax_requestedPlaylist",new L),this._events.set("trax_playingSong",new T),this._events.set("game_windowEvent",new b),this._events.set("game_invite",new $),this._events.set("game_ttt_board",new S)}onMessage(t){let e=JSON.parse(t.data);console.log(e),void 0!==e.header&&this.dispatchEvent(e)}addListener(t,e){this._listeners.push({event:t,listener:e})}removeListener(t,e){this._listeners=this._listeners.filter((s=>s=={event:t,listener:e}))}dispatchEvent(t){this._events.get(t.header).parse(t.data),this._listeners.forEach((e=>{e.event==t.header&&e.listener(this._events.get(t.header))}))}onOpen(){this.connected=!0,this.reconnect=0,this.sendMessage(new R(this._config.sso)),k.state.lang||this.sendMessage(new H),k.state.config||this.sendMessage(new V)}onClose(){this.connected=!1,this.interval=setInterval((()=>5===this.reconnect||this.connected?clearInterval(this.interval):(this.reconnect++,this._webSocket=new WebSocket(this._config.ws),this._webSocket.onmessage=this.onMessage.bind(this),this._webSocket.onopen=this.onOpen.bind(this),void(this._webSocket.onclose=this.onClose.bind(this)))),2e3)}sendMessage(t){this.connected?this._webSocket.send(JSON.stringify(t)):this.onClose()}}const K={playSong(t,e,s){this.$emit("play",t)},setTracks(){this.$store.state.trax.tracks=[];for(let t=0;t<4;t++){const t=[];for(let e=0;e<60;e++)t.push(this.selectedRes);this.$store.state.trax.tracks.push(t)}this.$forceUpdate(),this.$emit("stop"),this.$store.state.trax.editing&&this.setEditingTrack()},setEditingTrack(){let t=this.$store.state.trax.editing.track.split(":"),e=0;this.name=this.$store.state.trax.editing.name,t.forEach((t=>{let s=t.split(";");if(!s[0].includes(","))return;let n=0;s.forEach(((t,s)=>{let i=t.split(",");if(2!==i.length)return;if("0"==i[0])return;let a=this.findCollection(i[0]).collectionRet,o=this.findCollection(i[0]).setRet;if(this.$store.state.trax.tracks[e][s+n]={colour:a.colour,sound:i[0],set:o.set,id:this.findCollection(i[0]).setInd,hovering:!1,grouped:o.set,unique:!0},o.set>1)for(let r=1;r<o.set;r++)this.$store.state.trax.tracks[e][s+r+n]={colour:a.colour,sound:i[0],set:o.set,id:this.findCollection(i[0]).setInd,hovering:!1,grouped:!1,unique:!1};n+=o.set-1,this.$forceUpdate()})),e++}))},findCollection(t){let e=null,s=null,n=0;return this.$store.state.trax.collection.forEach((i=>{e||(n=0,i.sets.forEach((a=>{if(a.sound==t)return e=i,void(s=a);e||n++})))})),{collectionRet:e,setRet:s,setInd:n}},paginate(t){switch(t){case"next":if(this.$store.state.trax.currentPage===this.$store.state.trax.collectionPages)return;this.$store.state.trax.currentPage++;break;case"prev":if(1===this.$store.state.trax.currentPage)return;this.$store.state.trax.currentPage--}this.$store.state.trax.visibleCollection=this.$store.state.trax.collection.slice(6*(this.$store.state.trax.currentPage-1),6*this.$store.state.trax.currentPage)},findSound(t){return void 0===this.sounds["sound_machine_sample_"+t]&&(this.sounds["sound_machine_sample_"+t]=new Audio(UIExtConfig.sounds+"sound_machine_sample_"+t+".mp3")),this.sounds["sound_machine_sample_"+t]},playSound(t,e){if(!t)return;if(this.tuned)return;const s=this.findSound(t);if(e)return this.playing=s,this.playing.currentTime=0,void this.playing.play();s.play()},stopPlayingSound(){this.playing&&this.playing.pause(),this.playing=null},registerSelected(t,e,s,n){this.selected={colour:e,sound:t,set:s,id:n,hovering:!0,grouped:!1,unique:!0}},setTile(t,e){let s=!0;if(this.selected.hovering=!1,this.$forceUpdate(),!this.$store.state.trax.tracks[t][e].colour||this.$store.state.trax.tracks[t][e].hovering){for(let n=0;n<this.selected.set;n++)this.$store.state.trax.tracks[t][e+n].colour&&!this.$store.state.trax.tracks[t][e].hovering&&(s=!1);s&&this.setGroup(t,e)}else this.resetGroup(t,e,this.$store.state.trax.tracks[t][e].set)},resetGroup(t,e,s){for(let n=0;n<s;n++)this.$store.state.trax.tracks[t][e+n]=this.selectedRes;this.selected.hovering||(this.selected=this.selectedRes),this.$forceUpdate()},setGroup(t,e){for(let s=0;s<this.selected.set;s++){let n=!1;0===s&&this.selected.set>=1&&(n=!0),this.$store.state.trax.tracks[t][e+s]={colour:this.selected.colour,sound:this.selected.sound,set:this.selected.set,id:this.selected.id,hovering:this.selected.hovering,grouped:n,unique:n}}this.selected.hovering||(this.selected=this.selectedRes),this.$forceUpdate()},hoverSection(t,e,s){if(this.selected.colour){if(!s){this.hovered.i=t,this.hovered.ind=e;let s=!0;for(let n=0;n<this.selected.set;n++)this.$store.state.trax.tracks[t][e+n].colour&&(s=!1);if(s)return this.setGroup(t,e)}return s&&this.$store.state.trax.tracks[t][e].hovering?this.resetGroup(this.hovered.i,this.hovered.ind,this.$store.state.trax.tracks[t][e].set):void 0}},getSongString(){let t="",e=0;const s=[];return this.$store.state.trax.tracks.forEach(((t,n)=>{const i=[];let a=0;if(t.forEach(((t,e)=>{t.sound&&(a=e+1)})),t.forEach(((t,e)=>!t.sound&&a>e?i.push({track:0,len:1}):t.unique&&t.sound?i.push({track:t.sound,len:t.set}):void 0)),!a)return;a>e&&(e=a);const o=[];i.forEach((t=>{o.push(t.track+","+t.len)})),s.push(n+1+":"+o.join(";"))})),t=s.join(":"),{string:t,len:e}},stopSong(){this.$emit("stop")},saveSong:async function(){if(!this.getSongString().len)return;if(!this.name)return;let t=this.$store.state.trax.editing?this.$store.state.trax.editing.id:0;J.getInstance().sendMessage(new X(this.name,this.getSongString().string,this.getSongString().len,t))},startDragHandle(t){this.playing||(document.onmousemove=this.dragHandle,document.onmouseup=this.stopDragHandle,this.tracker.offset=t.clientX-this.$refs["tracker-handle"].offsetLeft)},dragHandle(t){event.preventDefault();let e=t.clientX-this.tracker.position-this.tracker.offset;e<0?e=0:e>this.$refs.tracker.offsetWidth&&(e=this.$refs.tracker.offsetWidth),this.tracker.position=e},stopDragHandle(t){t.preventDefault(),document.onmouseup=null,document.onmousemove=null}},Z={},Q={class:"trax-collections justify-content"},tt={class:"trax-collection-header text-truncate overflow-hidden"},et={class:"d-block text-align-center"},st={class:"trax-collection-grid"},nt=["theme","onMouseenter","onMousedown"];Z.render=function(i,o,l,m,p,f){const x=t("UIExtButton"),y=t("UIExtBorder");return a(),e("div",Q,[s(x,{theme:i.$store.state.config.trax.lists,onClicked:o[0]||(o[0]=t=>i.$parent.paginate("prev")),class:"d-flex align-items-center me-1",caption:"<i class='fas fa-chevron-left'></i>"},null,8,["theme"]),(a(!0),e(c,null,d(i.$store.state.trax.visibleCollection,((t,s)=>(a(),h(y,{theme:i.$store.state.config.trax.borders,key:"a"+s,class:"trax-collection"},{default:n((()=>[u("div",tt,[u("span",et,r(t.name),1)]),u("div",st,[(a(!0),e(c,null,d(t.sets,((s,n)=>(a(),e("div",{class:"trax-collection-grid-item uiExt-button",theme:i.$store.state.config.trax.buttons,style:g("background-color:"+t.colour),key:"c"+n,onMouseenter:t=>i.$parent.playSound(s.sound,!0),onMouseleave:o[1]||(o[1]=t=>i.$parent.stopPlayingSound()),onMousedown:e=>i.$parent.registerSelected(s.sound,t.colour,s.set,n)},null,44,nt)))),128))])])),_:2},1032,["theme"])))),128)),s(x,{theme:i.$store.state.config.trax.lists,onClicked:o[2]||(o[2]=t=>i.$parent.paginate("next")),class:"d-flex align-items-center",caption:"<i class='fas fa-chevron-right'></i>"},null,8,["theme"])])};const it={props:["tuned","timeInSeconds"],components:{Collections:Z},data:()=>({playing:null,selected:{},selectedRes:{colour:"",sound:0,set:0,id:0,hovering:!1,grouped:!1,unique:!0},name:"",hovered:{i:0,ind:0},sounds:[]}),mounted(){this.setTracks()},unmounted(){this.$emit("stop")},methods:K,beforeDestroy(){this.stopSong()}},at={class:"trax-editor"},ot={class:"w-100 d-flex flex-row my-1"},rt={class:"w-100 me-1 mb-0"},lt={class:"justify-content-end d-flex flex-row"},ct={class:"position-relative"},dt={class:"trax-tracks",ref:"tracker"},ht={class:"w-100 d-flex"},ut=["data-grouped","data-unique","onMousedown","onMouseenter","onMouseleave"],gt=["val"];it.render=function(n,o,r,l,x,y){const v=t("Collections"),_=t("UIExtButton");return a(),e("div",at,[n.$store.state.trax.collection?(a(),h(v,{key:0})):i("",!0),u("div",ot,[u("div",rt,[m(u("input",{type:"text",class:"w-100 form-control form-control-sm mb-0",placeholder:"My Sick Beatz","onUpdate:modelValue":o[0]||(o[0]=t=>x.name=t)},null,512),[[p,x.name]])]),u("div",lt,[r.tuned?(a(),h(_,{key:1,theme:n.$store.state.config.trax.buttons,colour:"danger",onClicked:o[2]||(o[2]=t=>n.stopSong()),caption:"<i class='fas fa-stop' />",class:"px-2 me-1"},null,8,["theme"])):(a(),h(_,{key:0,theme:n.$store.state.config.trax.buttons,colour:"success",onClicked:o[1]||(o[1]=t=>n.playSong(n.getSongString().string)),caption:"<i class='fas fa-play' />",class:"px-2 me-1"},null,8,["theme"])),s(_,{theme:n.$store.state.config.trax.lists,onClicked:o[3]||(o[3]=t=>n.saveSong()),caption:"<i class='far fa-save' />",class:"px-2 me-1"},null,8,["theme"]),s(_,{theme:n.$store.state.config.trax.buttons,colour:"danger",onClicked:o[4]||(o[4]=t=>n.setTracks()),caption:"<i class='fas fa-trash-alt' />",class:"px-2 me-1"},null,8,["theme"]),s(_,{theme:n.$store.state.config.trax.buttons,colour:"warning",onClicked:o[5]||(o[5]=t=>n.$emit("toggleEditor")),caption:"<i class='fas fa-sign-out-alt' />",class:"px-2"},null,8,["theme"])])]),u("div",ct,[u("div",dt,[(a(!0),e(c,null,d(n.$store.state.trax.tracks,((t,s)=>(a(),e("div",{key:"a"+s,class:"trax-track-row d-inline-table"},[u("div",ht,[(a(!0),e(c,null,d(t,((t,i)=>(a(),e("div",{key:"b"+i,class:f("trax-track-item uiExt-border"+(t.grouped?" trax-track-grouped":"")+(t.hovering?" hovered":"")),"data-grouped":t.set,"data-unique":t.unique,style:g("background-color:"+t.colour),theme:"0",onMousedown:t=>n.setTile(s,i),onMouseenter:t=>n.hoverSection(s,i,!1),onMouseleave:t=>n.hoverSection(s,i,!0)},[(a(!0),e(c,null,d(t.set,((s,n)=>(a(),e("div",{key:n,class:f(`trax-icon trax-icon-${t.id+1}`)},null,2)))),128))],46,ut)))),128))])])))),128)),n.$refs.tracker?m((a(),e("input",{key:0,type:"range",min:"0",max:"59",style:{width:"1563px"},"onUpdate:modelValue":o[6]||(o[6]=t=>n.$store.state.trax.traxplayer.position=t),val:n.$store.state.trax.traxplayer.position},null,8,gt)),[[p,n.$store.state.trax.traxplayer.position]]):i("",!0)],512)])])};const mt={props:["tuned","timeInSeconds"],data:()=>({songs:null,changed:!1,selected:{name:"The Habhop",length:"817"}}),mounted(){J.getInstance().sendMessage(new z),J.getInstance().sendMessage(new Y),J.getInstance().sendMessage(new N),this.$store.state.trax.editing=null},unmounted(){this.$emit("stop")},methods:{create(){this.$emit("toggleEditor")},burn(){this.selected.id&&J.getInstance().sendMessage(new G(this.selected.id))},editSong(){this.selected.id&&(this.$store.state.trax.editing=this.selected,this.$emit("toggleEditor"))},deleteSong(){this.selected.id&&(J.getInstance().sendMessage(new A(this.selected.id)),this.selected={name:"The Habhop",length:"817"},this.changed=!1)},preview(){this.tuned?this.$emit("stop"):this.$emit("play",this.selected.track)},addToPlaylist(t){J.getInstance().sendMessage(new W(t))},removeFromPlaylist(t){J.getInstance().sendMessage(new W(t,!0))},toggleJukebox(){J.getInstance().sendMessage(new F)},selectSong(t){this.selected=t,this.changed=!0,this.$emit("preload",t.track)}}},pt={class:"d-flex flex-row h-100"},ft={class:"w-100 me-1 h-100 d-flex flex-column"},xt={key:0,class:"h-100 overflow-y-scroll pe-1 mb-1"},yt={key:1,class:"w-100 me-1 h-100 mb-1"},vt=u("div",{class:"uiExtSplitter-ver"},null,-1),_t={class:"w-100 align-self-center h-100 d-flex flex-column"},wt={key:0,class:"h-100 overflow-y-scroll pe-1"},kt=u("div",{class:"uiExtSplitter-hor"},null,-1),$t={class:"d-block"},bt={class:"d-flex flex-row"},St={key:1,class:"d-flex flex-row justify-content-between"};mt.render=function(l,g,m,p,x,y){const v=t("UIExtButton"),_=t("UIExtBorder");return a(),e("div",pt,[u("div",ft,[l.$store.state.trax.songs&&l.$store.state.trax.songs.length?(a(),e("div",xt,[(a(!0),e(c,null,d(l.$store.state.trax.songs,((t,n)=>(a(),e("div",{class:"d-flex flex-row w-100 mb-1",key:n},[s(v,{class:f(["w-100",{isburneddisc:t.disc}]),theme:l.$store.state.config.trax.lists,caption:t.name,onClicked:e=>y.selectSong(t)},null,8,["class","theme","caption","onClicked"]),s(v,{theme:l.$store.state.config.trax.buttons,caption:"<i class='fas fa-angle-double-right'></i>",onClicked:e=>y.addToPlaylist(t.id),colour:"success",class:"ms-1 px-1"},null,8,["theme","onClicked"])])))),128))])):(a(),e("div",yt,r(l.$filters.translate("trax.window.no_songs")),1)),s(v,{theme:l.$store.state.config.trax.buttons,caption:l.$filters.translate("trax.window.create"),onClicked:g[0]||(g[0]=t=>y.create()),colour:"dark"},null,8,["theme","caption"]),s(v,{theme:l.$store.state.config.trax.buttons,caption:l.$store.state.trax.playlist.playing?l.$filters.translate("trax.window.stopPlaylist"):l.$filters.translate("trax.window.playPlaylist"),onClicked:g[1]||(g[1]=t=>y.toggleJukebox()),colour:l.$store.state.trax.playlist.playing?"danger":"success",class:"mt-1"},null,8,["theme","caption","colour"])]),vt,u("div",_t,[l.$store.state.trax.playlist.songs?(a(),e("div",wt,[(a(!0),e(c,null,d(l.$store.state.trax.playlist.songs,((t,n)=>(a(),e("div",{class:"d-flex flex-row w-100 mb-1",key:n},[s(v,{class:f(["me-1",{isburneddisc:t.disc}]),theme:l.$store.state.config.trax.buttons,caption:"<i class='fas fa-angle-double-left'></i>",onClicked:e=>y.removeFromPlaylist(t.id),colour:"danger"},null,8,["class","theme","onClicked"]),s(v,{class:"w-100 text-truncate",theme:l.$store.state.config.trax.lists,caption:t.song.name,onClicked:e=>y.selectSong(t.song)},null,8,["theme","caption","onClicked"])])))),128))])):i("",!0),kt,s(_,{theme:l.$store.state.config.trax.borders,class:"p-1 text-center mb-1",ref:"tracker"},{default:n((()=>[u("b",$t,r(x.selected.name),1),o(" "+r(l.$filters.secondsDuration(m.tuned?m.timeInSeconds:x.selected.length))+" ",1),u("div",bt,[m.tuned?(a(),h(v,{key:1,theme:l.$store.state.config.trax.buttons,caption:l.$filters.translate("trax.window.stop"),onClicked:g[3]||(g[3]=t=>y.preview()),colour:"danger",class:"w-100"},null,8,["theme","caption"])):(a(),h(v,{key:0,theme:l.$store.state.config.trax.buttons,caption:l.$filters.translate("trax.window.preview"),onClicked:g[2]||(g[2]=t=>y.preview()),colour:"success",class:f([{"uiExt-button-disabled":!x.changed},"w-100"])},null,8,["theme","caption","class"]))])])),_:1},8,["theme"]),x.selected.disc?i("",!0):(a(),e("div",St,[s(v,{class:f([{"uiExt-button-disabled":!x.changed},"w-100"]),theme:l.$store.state.config.trax.buttons,caption:"<i class='far fa-trash-alt'></i>",onClicked:g[4]||(g[4]=t=>y.deleteSong()),colour:"danger"},null,8,["class","theme"]),s(v,{class:f([{"uiExt-button-disabled":!x.changed},"w-100 mx-1"]),theme:l.$store.state.config.trax.buttons,caption:"<i class='fas fa-edit'></i>",onClicked:g[5]||(g[5]=t=>y.editSong()),colour:"warning"},null,8,["class","theme"]),s(v,{class:f([{"uiExt-button-disabled":!x.changed},"w-100"]),theme:l.$store.state.config.trax.buttons,caption:"<i class='fas fa-compact-disc'></i>",onClicked:g[6]||(g[6]=t=>y.burn()),colour:"success"},null,8,["class","theme"])]))])])};class It{constructor(){It._instance=this,Tt.getInstance().communication.addListener("trax_window",this.setWindow),Tt.getInstance().communication.addListener("trax_requestedSongs",this.setRequestedSongs),Tt.getInstance().communication.addListener("trax_requestedCollections",this.setCollections),Tt.getInstance().communication.addListener("trax_requestedPlaylist",this.setPlaylist),Tt.getInstance().communication.addListener("trax_playingSong",this.setPlaying),Tt.getInstance().communication.addListener("volume",this.setVolume)}static getInstance(){return It._instance||(It._instance=new It),It._instance}setWindow(t){k.state.window.trax=t.status,k.state.trax.editor=t.editor}setRequestedSongs(t){k.state.trax.songs=t.songs}setCollections(t){k.state.trax.collection=t.collection,k.state.trax.visibleCollection=t.collection.slice(0,6),k.state.trax.collectionPages=Math.ceil(t.collection.length/6)}setPlaylist(t){k.state.trax.playlist=t.playlist}setPlaying(t){k.state.trax.playingSong=t.playing}setVolume(t){k.state.trax.volume=t.volume}}class Et{constructor(){Et._instance=this,Tt.getInstance().communication.addListener("config",this.setConfig),Tt.getInstance().communication.addListener("language",this.setLang),Tt.getInstance().communication.addListener("alert",this.setAlert)}static getInstance(){return Et._instance||(Et._instance=new Et),Et._instance}setConfig(t){k.state.config=t.config}setLang(t){k.state.lang=t.lang}setAlert(t){let e={window:t.window,message:t.message,type:t.type};switch(t.window){case"trax":k.state.trax.alert=e;break;case"game.ttt":k.state.games.ttt.alert=e}}}class Ct{constructor(){Ct._instance=this,Tt.getInstance().communication.addListener("game_windowEvent",this.gameWindow),Tt.getInstance().communication.addListener("game_invite",this.gameInvite),Tt.getInstance().communication.addListener("game_ttt_board",this.gameTTTBoard)}static getInstance(){return Ct._instance||(Ct._instance=new Ct),Ct._instance}gameWindow(t){switch(t.game){case"ttt":k.state.window.ttt=t.visible,k.state.games.ttt.playing=t.playing}}gameInvite(t){switch(t.game){case"ttt":if(t.existingInvite(k.state.games.ttt.invites,t.user.id).length)return;k.state.games.ttt.invites.push(t.user)}}gameTTTBoard(t){k.state.games.ttt.board=t.board,k.state.games.ttt.turn=t.turn,k.state.games.ttt.me=t.me}}class Tt{constructor(){Tt._instance=this,this._communication=J.getInstance(),this._app=Et.getInstance(),this._trax=It.getInstance(),this._games=Ct.getInstance()}static getInstance(){return Tt._instance||(Tt._instance=new Tt),Tt._instance}get communication(){return this._communication}get trax(){return this._trax}get game(){return this._games}}class Pt{constructor(t,e){this._ready=!1,this._traxLengthInSeconds=0,this._playing=!1,this._ticker=null,this._timeInSeconds=0,this._localLength=0,this._localPos=0,this._vue=null,this._cached=[],this._soundString="",this.timeOffset=0,this._volume=k.state.trax.volume,this._vue=e,this.samples=[],this.resetTracks(),this.preload(t),Tt.getInstance().communication.addListener("volume",this.setVolume.bind(this))}setVolume(t){this._volume=t.volume,this._tracks.forEach((t=>{t.player.volume=this._volume/100})),this.samples.forEach((t=>{t.forEach((t=>{t.sample.audioObj.volume=this._volume/100}))}))}resetTracks(){for(var t=[],e=0;e<10;e++)t.push({player:new Audio,timeLeft:0,blocks:0,sample:0,playlist:[]});console.log(this._tracks),this._tracks&&this._tracks.forEach((t=>{t.player.remove(),t.player.srcObject=null})),this._tracks=t}getSampleUrl(t){return UIExtConfig.sounds+"sound_machine_sample_"+t+".mp3"}getUniqueSamples(t){var e=[],s=[];return t.forEach(((t,n)=>{e[n]=[];const i=[];for(let s=0;s<t.length;s++)e[n][t[s].piece]||(e[n][t[s].piece]=!0,i.push(t[s]));s.push(i)})),s}getDuration(t){let e=this.getSampleUrl(t.piece);void 0===this._cached[e]&&(this._cached[e]=new Audio,this._cached[e].src=e);let s=this._cached[e].cloneNode(!1);return{sampleLength:t.blocks,sample:Object.assign({},t),audioObj:s,src:s.src}}getTrack(t){var e=[];return t.split(";").forEach((t=>{var s=t.split(",")[0],n=t.split(",")[1];this._localLength+=parseInt(t.split(",")[1]),e.push({blocks:n,piece:s})})),e}getTracks(t){let e=[];return this._localLength=0,t.split(":").forEach((t=>{t.includes(",")&&e.push(this.getTrack(t))})),e}preload(t){this._soundString=t,this.resetTracks();const e=this.getTracks(t);this.getUniqueSamples(e).forEach(((t,e)=>{this.samples[e]=[],t.forEach(((t,s)=>{this.samples[e][t.piece]=t,this.samples[e][t.piece].sample=this.getDuration(t)}))})),e.forEach(((t,e)=>{const s=[];t.forEach((t=>{const n=t.blocks/this.samples[e][t.piece].sample.sampleLength;for(let i=0;i<n;i++){s.push(t.piece);for(let n=0;n<this.samples[e][t.piece].sample.sampleLength-1;n++)s.push("0")}})),this._tracks[e].playlist=s})),this.calculatePlaytime(),this.onReady()}calculatePlaytime(){var t=this._tracks[0].playlist;this._tracks.forEach((e=>{e.playlist.length>t.length&&(t=e.playlist)})),this._traxLengthInSeconds=2*t.length}onReady(){this._ready=!0}playNextBeat(t){let e=this._localPos;if(void 0!==this.samples[t]&&this.samples[t][this._tracks[t].playlist[e]]){let s=e-k.state.trax.traxplayer.position+1;this.timeOffset&&void 0!==this._tracks[t].playlist[s]?(console.log("offset"),console.log(this._tracks[t].playlist,s),this._tracks[t].player=this.samples[t][this._tracks[t].playlist[s]].sample.audioObj,this._tracks[t].timeLeft=this.samples[t][this._tracks[t].playlist[s]].sample.sampleLength,this._tracks[t].blocks=this._tracks[t].playlist[s].blocks,this._tracks[t].sample=this._tracks[t].playlist[s].sample):(this._tracks[t].player=this.samples[t][this._tracks[t].playlist[e]].sample.audioObj,this._tracks[t].timeLeft=this.samples[t][this._tracks[t].playlist[e]].sample.sampleLength,this._tracks[t].blocks=this._tracks[t].playlist[e].blocks,this._tracks[t].sample=this._tracks[t].playlist[e].sample),0!=this._tracks[t].sample&&(this._tracks[t].player.currentTime=this.timeOffset,this._tracks[t].player.volume=this._volume/100,this._tracks[t].player.play())}}play(){this._playing=!0,k.state.trax.traxplayer.position=0,this._localPos=k.state.trax.traxplayer.position,this.timeOffset=2*k.state.trax.traxplayer.position,this.tick(!1),this._ticker=setInterval(this.tick.bind(this),2e3),this._time=setInterval(this.time.bind(this),1e3),this._vue.tuned=this._playing}stop(){this._localPos=0,k.state.trax.traxplayer.position=0,this.timeOffset=0,this._playing=!1,this.resetPlayer(),this._vue.tuned=this._playing}tick(t=!0){this._playing&&(this._tracks.forEach(((t,e)=>{this.playNextBeat(e)})),this.timeOffset=0,t&&(k.state.trax.traxplayer.position+=1),this._localPos++)}clearElements(){}time(){this._timeInSeconds=this._timeInSeconds+1,this._timeInSeconds>=this._traxLengthInSeconds&&(this.resetPlayer(),this.play())}resetPlayer(){clearInterval(this._ticker),clearInterval(this._time),this._timeInSeconds=0,k.state.trax.traxplayer.position=0,this._tracks.forEach((t=>{t.player.pause(),t.player.remove(),t.player.srcObject=null})),this.samples.forEach((t=>{t.forEach((t=>{t.sample.audioObj.pause(),t.sample.audioObj.remove(),t.sample.audioObj.srcObject=null}))}))}}const Lt={components:{ListView:mt,Editor:it,Alert:_},data:()=>({tuned:!1,traxplayer:null}),mounted(){this.traxplayer=new Pt("",this)},methods:{toggleEditor(){this.$store.state.trax.editor=!this.$store.state.trax.editor,setTimeout((()=>{this.$refs.card.centerDiv()}),0)},toggle(){this.$store.state.window.trax=!1},preload(t){this.traxplayer&&this.traxplayer.preload(t)},playSong(t){this.traxplayer&&(this.traxplayer.preload(t),this.traxplayer.play())},stopSong(){this.traxplayer&&this.traxplayer.stop()}}};Lt.render=function(e,o,r,l,c,d){const u=t("ListView"),g=t("Editor"),m=t("Alert"),p=t("UIExtCard");return e.$store.state.window.trax?(a(),h(p,{key:0,title:e.$filters.translate("trax.window.title"),theme:e.$store.state.config.trax.theme,onClicked:o[3]||(o[3]=t=>d.toggle()),class:f(this.$store.state.trax.editor?"trax-window-editor":"trax-window-list"),center:"true",ref:"card"},{default:n((()=>[this.$store.state.trax.editor?(a(),h(g,{key:1,onToggleEditor:o[1]||(o[1]=t=>d.toggleEditor()),tuned:c.tuned,timeInSeconds:c.traxplayer?c.traxplayer._timeInSeconds:0,onPreload:d.preload,onPlay:d.playSong,onStop:d.stopSong},null,8,["tuned","timeInSeconds","onPreload","onPlay","onStop"])):(a(),h(u,{key:0,onToggleEditor:o[0]||(o[0]=t=>d.toggleEditor()),tuned:c.tuned,timeInSeconds:c.traxplayer?c.traxplayer._timeInSeconds:0,onPreload:d.preload,onPlay:d.playSong,onStop:d.stopSong},null,8,["tuned","timeInSeconds","onPreload","onPlay","onStop"])),s(m,{theme:e.$store.state.config.trax.theme,alert:e.$store.state.trax.alert,onClear:o[2]||(o[2]=t=>e.$store.state.trax.alert=null)},null,8,["theme","alert"])])),_:1},8,["title","theme","class"])):i("",!0)};const Mt={data:()=>({input:null}),methods:{sendRequest(){this.input&&(J.getInstance().sendMessage(new O("ttt",this.input)),this.input=null)},startGame(t){J.getInstance().sendMessage(new j("ttt",t)),this.$emit("recenter")},deleteInvite(t){this.$store.state.games.ttt.invites.splice(t,1)},inviteFriends(){J.getInstance().sendMessage(new O("ttt","",!0))}}},Ut={class:"h-100 d-flex flex-column"},qt=["placeholder"],Dt=u("div",{class:"uiExtSplitter-hor"},null,-1),Ot={key:0,class:"overflow-y-scroll h-100 pe-1"},jt={key:1,class:"w-100 text-center"},Bt={class:"mt-auto"};Mt.render=function(n,i,o,l,h,g){const f=t("UIExtButton");return a(),e("div",Ut,[m(u("input",{type:"text",class:"uiExt-input w-100 mb-1",placeholder:n.$filters.translate("games.ttt.window.request_input"),onKeyup:i[0]||(i[0]=x((t=>g.sendRequest()),["enter"])),"onUpdate:modelValue":i[1]||(i[1]=t=>h.input=t)},null,40,qt),[[p,h.input]]),Dt,n.$store.state.games.ttt.invites.length?(a(),e("div",Ot,[(a(!0),e(c,null,d(n.$store.state.games.ttt.invites,((t,i)=>(a(),e("div",{class:"d-flex flex-row w-100 mb-1",key:i},[s(f,{caption:t.username,theme:n.$store.state.config.games.ttt.lists,class:"w-100"},null,8,["caption","theme"]),s(f,{caption:"<i class='fas fa-check'></i>",theme:n.$store.state.config.games.ttt.buttons,colour:"success",class:"px-2 mx-1",onClicked:e=>{g.startGame(t.id),g.deleteInvite(i)}},null,8,["theme","onClicked"]),s(f,{caption:"<i class='fas fa-times'></i>",theme:n.$store.state.config.games.ttt.buttons,colour:"danger",class:"px-2",onClicked:t=>g.deleteInvite(i)},null,8,["theme","onClicked"])])))),128))])):(a(),e("div",jt,r(n.$filters.translate("games.no_invites")),1)),u("div",Bt,[s(f,{caption:n.$filters.translate("games.invite_friends"),theme:n.$store.state.config.games.ttt.buttons,colour:"dark",onClicked:i[2]||(i[2]=t=>g.inviteFriends()),class:"mt-1"},null,8,["caption","theme"])])])};const Rt={methods:{clickCell(t,e){""===this.$store.state.games.ttt.board[t][e]&&J.getInstance().sendMessage(new B(t,e))}}},Vt={class:"h-100 uiExt-game-ttt"},Ht={class:"h-100"},Gt=["onClick"],Xt=["theme"],At={class:"w-100 d-flex flex-row justify-content-between"};Rt.render=function(t,s,n,i,l,h){return a(),e("div",Vt,[u("div",Ht,[(a(!0),e(c,null,d(t.$store.state.games.ttt.board,((t,s)=>(a(),e("div",{class:"d-flex flex-row w-100 justify-content-center uiExt-game-ttt-board-row",key:`r${s}`},[(a(!0),e(c,null,d(t,((t,n)=>(a(),e("div",{class:"d-flex flex-row uiExt-game-ttt-board-cell",key:`c${n}`,onClick:t=>h.clickCell(s,n)},r(t),9,Gt)))),128))])))),128))]),u("div",{class:"uiExtSplitter-hor",theme:t.$store.state.config.games.ttt.theme},null,8,Xt),u("div",At,[u("div",{class:f({"text-success":t.$store.state.games.ttt.turn!==t.$store.state.games.ttt.me})},[o(r(t.$filters.translate("games.ttt.window.player"))+": ",1),u("b",null,r("o"==t.$store.state.games.ttt.me?"x":"o"),1)],2),u("div",{class:f({"text-success":t.$store.state.games.ttt.turn==t.$store.state.games.ttt.me})},[o(r(t.$filters.translate("games.ttt.window.you"))+": ",1),u("b",null,r(t.$store.state.games.ttt.me),1)],2)])])};const Wt={components:{ListView:Mt,Alert:_,GameView:Rt},methods:{playing(){setTimeout((()=>{this.$refs.container.centerDiv()}),30)}},mounted(){this.$store.state.games.ttt.alert=null}};Wt.render=function(e,i,o,r,l,c){const d=t("Alert"),u=t("ListView"),g=t("GameView"),m=t("UIExtCard");return a(),h(m,{title:e.$filters.translate("games.ttt.window.title"),theme:e.$store.state.config.games.ttt.theme,center:"true",class:f(e.$store.state.games.ttt.playing?"games-window-ttt-board":"games-window-ttt"),ref:"container",hideclose:"true"},{default:n((()=>[s(d,{theme:e.$store.state.config.games.ttt.theme,alert:e.$store.state.games.ttt.alert,onClear:i[0]||(i[0]=t=>e.$store.state.games.ttt.alert=null)},null,8,["theme","alert"]),e.$store.state.games.ttt.playing?(a(),h(g,{key:1})):(a(),h(u,{key:0,onRecenter:i[1]||(i[1]=t=>c.playing())}))])),_:1},8,["title","theme","class"])};const Yt={components:{TicTacToe:Wt}};Yt.render=function(s,n,o,r,l,c){const d=t("TicTacToe");return a(),e("div",null,[s.$store.state.window.ttt?(a(),h(d,{key:0})):i("",!0)])};const Nt={data:()=>({tuned:!1,traxplayer:null}),mounted(){this.traxplayer=new Pt(this.$store.state.trax.playingSong.track,this),this.traxplayer.play()},unmounted(){this.traxplayer.stop()}},zt={id:"trax-playlist-preview",class:"d-none"};Nt.render=function(t,s,n,i,o,l){return a(),e("div",zt,r(t.$store.state.trax.playingSong),1)};var Ft={components:{TraxEditor:Lt,Games:Yt,TraxPlaylist:Nt},mounted(){Tt.getInstance()}};const Jt={class:"position-absolute"};Ft.render=function(n,o,r,l,d,u){const g=t("TraxEditor"),m=t("TraxPlaylist"),p=t("Games");return a(),e("div",Jt,[n.$store.state.config?(a(),e(c,{key:0},[s(g),n.$store.state.trax.playingSong?(a(),h(m,{key:0})):i("",!0),s(p)],64)):i("",!0)])};var Kt={props:{theme:String,title:String,center:String,hideclose:Boolean},data:()=>({positions:{clientX:void 0,clientY:void 0,movementX:0,movementY:0},close:!0}),mounted(){this.$props.center&&this.centerDiv(),this.$props.hideclose&&(this.close=!1),this.bringToTop()},methods:{bringToTop(){let t=document.getElementsByClassName("uiExt-card"),e=1;if(t.length){for(let s of t){let t=s,n=t.style.zIndex;n&&null!=n||(n=document.defaultView.getComputedStyle(s,null).getPropertyValue("z-index"),t.style.zIndex=n),parseInt(n)>e&&(e=parseInt(n))}e&&(e++,this.$refs.draggableContainer.style.zIndex=e)}},dragMouseDown:function(t){t.preventDefault(),this.positions.clientX=t.clientX,this.positions.clientY=t.clientY,document.onmousemove=this.elementDrag,document.onmouseup=this.closeDragElement},elementDrag:function(t){t.preventDefault(),this.positions.movementX=this.positions.clientX-t.clientX,this.positions.movementY=this.positions.clientY-t.clientY,this.positions.clientX=t.clientX,this.positions.clientY=t.clientY,this.$refs.draggableContainer.style.top=this.$refs.draggableContainer.offsetTop-this.positions.movementY+"px",this.$refs.draggableContainer.style.left=this.$refs.draggableContainer.offsetLeft-this.positions.movementX+"px"},closeDragElement(){document.onmouseup=null,document.onmousemove=null},centerDiv(){let t=this.$refs.draggableContainer,e=t.offsetWidth/2,s=document.body.offsetWidth/2,n=t.offsetHeight/2,i=document.body.offsetHeight/2;t.style.left=s-e+"px",t.style.top=i-n+"px"}}};const Zt=["theme"],Qt=["innerHTML"],te={class:"uiExt-cardBody h-100 overflow-hidden"};Kt.render=function(t,s,n,o,r,l){return a(),e("div",{class:"uiExt-card position-absolute d-flex flex-column",theme:n.theme,ref:"draggableContainer",onMousedown:s[2]||(s[2]=t=>l.bringToTop())},[u("div",{class:"uiExt-cardHeader",onMousedown:s[1]||(s[1]=(...t)=>l.dragMouseDown&&l.dragMouseDown(...t))},[u("span",{innerHTML:n.title},null,8,Qt),r.close?(a(),e("div",{key:0,class:"uiExt-cardClose",onClick:s[0]||(s[0]=e=>t.$emit("clicked"))})):i("",!0)],32),u("div",te,[y(t.$slots,"default")])],40,Zt)};var ee={props:["theme","caption","colour"]};const se=["theme"],ne=["innerHTML"];ee.render=function(t,s,n,i,o,r){return a(),e("div",{class:f(["uiExt-button",n.colour?`bg-${n.colour}`:""]),theme:n.theme,onClick:s[0]||(s[0]=e=>t.$emit("clicked"))},[u("span",{innerHTML:n.caption},null,8,ne)],10,se)};var ie={props:["theme"]};const ae=["theme"];ie.render=function(t,s,n,i,o,r){return a(),e("div",{class:"uiExt-border",theme:n.theme},[y(t.$slots,"default")],8,ae)};const oe=v(Ft);oe.use(k),oe.component("UIExtCard",Kt),oe.component("UIExtButton",ee),oe.component("UIExtBorder",ie),oe.config.globalProperties.$filters={secondsDuration(t){const e=new Date(0);return e.setSeconds(parseInt(t)),e.toISOString().substr(11,8).substring(3)+"min"},translate:t=>function(t){const e=(s,n=[],i=null)=>(i=i[s])?n.length?e(n.shift(),n,i):i:t,s=t.split(".");return e(s.shift(),s,k.state.lang)}(t)},oe.config.globalProperties.$store=k,oe.mount("#uiext-app");window.console.log.apply(console,["%c\n This hotel is using UI-Extensions (0.2.0) by Laynester 2021 - Join the discord server: https://discord.gg/Za4Bu6wkar \n","color: red; background: #000000; padding:3px 0;"]);
